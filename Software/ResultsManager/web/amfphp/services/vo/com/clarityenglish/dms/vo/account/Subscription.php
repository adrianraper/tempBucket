<?php
class Subscription {

	/*
	 * AMFPHP Custom Class mapping
	 */
	var $_explicitType = 'com.clarityenglish.dms.vo.account.Subscription';

	// The id for the record in the subscription table
	public $id;
	
	// This data will be a subset of the ApiInformation class
	public $name;
	public $email;
	public $country;
	public $deliveryFrequency;
	public $contactMethod;
	public $languageCode;
	public $startDate;
	public $password;
	public $status;
	public $discountCode;
	public $offerID;
	public $resellerID;
	public $orderRef;
	// To make it easier to pick out recent rows
	public $dateStamp;
	
	// Never sent, but stored after account is created
	public $rootID;
	
	public function Subscription($id = null) {
		
		if ($id)
			$this->id = $id;
		
	}
	
	/**
	 * Take the information out of $obj (generated by AdoDB FetchNextObject()) and set the attributes of this object based on it
	 *
	 * @param obj The object returned for the record by FetchNextObject()
	 */
	public function fromDatabaseObj($obj, $db = null) {
		
		$this->id = $obj->F_SubscriptionID;
		$this->name = $obj->F_FullName;
		$this->email = $obj->F_Email;
		$this->country = $obj->F_Country;
		
		$this->password = $obj->F_Password;
		$this->status = $obj->F_Status;
		$this->discountCode = $obj->F_DiscountCode;
		$this->rootID = $obj->F_RootID;
		$this->offerID = $obj->F_OfferID;
		$this->resellerID = $obj->F_ResellerCode;
		$this->deliveryFrequency = $obj->F_DeliveryFrequency;
		$this->contactMethod = $obj->F_ContactMethod;
		$this->startDate = substr($obj->F_StartDate,0,10).' 00:00:00';
		$this->languageCode = $obj->F_LanguageCode;
		$this->orderRef = $obj->F_OrderRef;
		$this->dateStamp = $obj->F_DateStamp;
	}		
	/**
	 * Convert this object to an associative array ready to pass to AutoExecute.
	 */
	function toAssocArray() {
		$array = array();
		
		$array['F_FullName'] = $this->name;
		$array['F_Email'] = $this->email;
		$array['F_Country'] = $this->country;
		$array['F_Password'] = $this->password;
		$array['F_Status'] = $this->status;
		$array['F_DiscountCode'] = $this->discountCode;
		$array['F_RootID'] = $this->rootID;
		$array['F_OfferID'] = $this->offerID;
		$array['F_ResellerCode'] = $this->resellerID;
		$array['F_DeliveryFrequency'] = $this->deliveryFrequency;
		$array['F_ContactMethod'] = $this->contactMethod;
		$array['F_StartDate'] = $this->startDate;
		$array['F_LanguageCode'] = $this->languageCode;
		$array['F_OrderRef'] = $this->orderRef;
		$array['F_DateStamp'] = ($this->dateStamp) ? $this->dateStamp : date('Y-m-d H:i:s');

		return $array;
	}
	
	/**
	 * Create this object from an array of passed data. Most likely comes from an api
	 */
	public function createFromSentFields($info) {
		
		if (isset($info['subscriptionID'])) 
			$this->id = $info['subscriptionID'];
			
		if (isset($info['name']))
			$this->name = $info['name'];
		if (isset($info['email'])) 
			$this->email = $info['email'];
		if (isset($info['orderRef']))
			$this->orderRef = $info['orderRef'];
		if (isset($info['resellerID']))
			$this->resellerID = $info['resellerID'];
		if (isset($info['country']))
			$this->country = $info['country'];
		if (isset($info['languageCode'])) 
			$this->languageCode = $info['languageCode'];
		if (isset($info['contactMethod']))
			$this->contactMethod = $info['contactMethod'];
		if (isset($info['deliveryFrequency']))
			$this->deliveryFrequency = $info['deliveryFrequency'];
		if (isset($info['password']))
			$this->password = $info['password'];
			
		// Default values
		if (isset($info['dateStamp'])) {
			$this->dateStamp = $info['dateStamp'];
		} else {
			$this->dateStamp = date('Y-m-d H:i:s');
		}
			
		// Check the datatype. we want to end up with a comma delimmited list
		if (isset($info['offerID'])) {
			if (is_array($info['offerID'])) {
				$this->offerID = implode(",", $info['offerID']);
			} else {
				$this->offerID = $info['offerID'];
			}
		}	
		
		// You store the unique discount code in subscription, a general one is not saved
		if (isset($info['uniqueDiscountCode']))
			$this->discountCode = $info['uniqueDiscountCode'];
			
		// Possible aliases
		if (isset($info['status'])) { 
			$this->status = $info['status'];
		} elseif (isset($info['subscriptionStatus'])) {
			$this->status = $info['subscriptionStatus'];
		}
			
	}
	/**
	 * If you want to print a subscription record
	 */
	public function toString() {
		echo $this->id.' '.$this->name.' ',$this->email.', status='.$this->status;
	}
}	
