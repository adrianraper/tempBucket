<?xml version="1.0" encoding="utf-8"?>
<s:Skin xmlns:fx="http://ns.adobe.com/mxml/2009" 
		xmlns:s="library://ns.adobe.com/flex/spark" 
		xmlns:mx="library://ns.adobe.com/flex/mx"
		xmlns:local="*">
	<!-- host component -->
	<fx:Metadata>
		[HostComponent("com.clarityenglish.ielts.view.account.AccountView")]
	</fx:Metadata>
	
	<fx:Script>
		<![CDATA[
			import org.davekeen.util.DateUtil;
			import com.clarityenglish.common.vo.manageable.User;
			
			// TODO. There is a dateFormatter in configProxy that we should probably use
			// See HomeMediator for how it is injected into that view.
			import mx.events.CalendarLayoutChangeEvent;
			private function formatExamDetails(userDetails:User, type:String):String {
				switch (type) {
					case 'date':
						return DateUtil.formatDate(userDetails.examDate,'yyyy-MM-dd');
						break;
					case 'hours':
						return DateUtil.formatDate(userDetails.examDate,'HH');
						break;
					case 'mins':
						return DateUtil.formatDate(userDetails.examDate,'mm');
						break;
				}
				return null;
			}
			private function dateChooserInit(userDetails:User):void {
				examDate.selectedDate = userDetails.examDate;
				var selectStartDate:Date = (userDetails.registrationDate) ? DateUtil.ansiStringToDate(userDetails.registrationDate) : new Date();
				var selectEndDate:Date = new Date((new Date().getTime() + (365*24*60*60*1000)));
				examDate.selectableRange = {rangeStart: selectStartDate, rangeEnd: selectEndDate};
			}
			private function formatScreenDate(date:Date):String {
				return DateUtil.formatDate(date,'d MMMM yyyy');
			}

		]]>
	</fx:Script>
	
	<s:layout>
		<s:HorizontalLayout paddingTop="5" />
	</s:layout>
	
	<s:VGroup width="60%" paddingTop="20" >
		<s:Label text="My Profile" fontSize="20" width="50%" />
		
		<s:Rect left="100" right="0" top="180" bottom="0" width="100%" height="1" >
			<s:fill>
				<s:SolidColor color="0x999999" />
			</s:fill>
		</s:Rect>
		
		<s:Spacer height="10" />
		<s:HGroup width="100%" height="100%" top="120" >
			<s:VGroup width="110" height="100%" >
				<s:Label text="Registered name:" />
				<s:Spacer height="3" />
				<s:Label text="Email:"/>
				<s:Spacer height="3" />
				<s:Label text="Account start date:"/>		
				<s:Spacer height="3" />
				<s:Label text="Account expiry date:"/>		
				<s:Spacer height="3" />
				<s:VGroup id="passwordLabelsGroup" includeInLayout="{hostComponent.productVersion!='lastMinute'}" width="100%" height="100%" >
					<s:Label text="Current password:" />
					<s:Spacer height="3" />
					<s:Label text="New password:" />
					<s:Spacer height="3" />
					<s:Label text="Confirm password:" />
					<s:Spacer height="3" />
				</s:VGroup>
			</s:VGroup>
			<s:VGroup width="50%" height="100%" top="120" >
				<s:Label text="{hostComponent.userDetails.fullName}" fontWeight="bold" />
				<s:Spacer height="3" />
				<s:Label text="{hostComponent.userDetails.email}" fontWeight="bold" />
				<s:Spacer height="3" />
				<s:Label text="{DateUtil.formatDate(DateUtil.ansiStringToDate(hostComponent.userDetails.registrationDate),'d MMMM yyyy')}" fontWeight="bold"/>		
				<s:Spacer height="3" />
				<s:Label text="{DateUtil.formatDate(DateUtil.ansiStringToDate(hostComponent.userDetails.expiryDate),'d MMMM yyyy')}" fontWeight="bold"/>
				<s:Spacer height="3" />
				<s:VGroup id="passwordFieldsGroup" includeInLayout="{hostComponent.productVersion!='lastMinute'}" width="100%" height="100%" >
					<s:TextInput id="currentPassword" width="180" />
					<s:Spacer height="3" />
					<s:TextInput id="newPassword" width="180" />
					<s:Spacer height="3" />
					<s:TextInput id="confirmPassword" width="180" />
					<s:Spacer height="3" />
				</s:VGroup>
			</s:VGroup>
		</s:HGroup>
		
		<s:Spacer height="3" />

		<local:CountdownDisplay targetDate="{hostComponent.userDetails.examDate}"/>

		<s:Spacer height="10" />
		
		<s:HGroup width="100%" height="100%" top="120" >
			<mx:DateField id="examDate" creationComplete="dateChooserInit(hostComponent.userDetails);" 
						  labelFunction="formatScreenDate" />
			<s:NumericStepper id="examHours" minimum="0" maximum="23" stepSize="1" 
							   value="{Number(formatExamDetails(hostComponent.userDetails, 'hours'))}" textAlign="center"/>
			<s:NumericStepper id="examMinutes" minimum="0" maximum="59" stepSize="1" 
							   value="{Number(formatExamDetails(hostComponent.userDetails, 'mins'))}" textAlign="center"/>
		</s:HGroup>
		<s:Spacer height="10" />
		<s:Button id="saveChangesButton" label="Save changes" />
		
	</s:VGroup>
	<s:VGroup width="40%" paddingTop="20" >
		<s:Label text="IELTS Apps" fontSize="20" width="50%" />
		
		<s:Rect left="100" right="0" top="180" bottom="0" width="100%" height="1" >
			<s:fill>
				<s:SolidColor color="0x999999" />
			</s:fill>
		</s:Rect>
		<!-- 						 
			source="@Embed(source='skins/ielts/assets/countdown.swf?widgetdatawidth=200&widgetdataheight=300&widgetdatalanguage=EN&widgetdatacountry=none&widgetdatabclogo=true')"
		-->
		<s:Group width="241" height="301">
			<s:SWFLoader source="@Embed(source='skins/ielts/assets/bcwidget.png')" width="100%" />
		</s:Group>
	</s:VGroup>
</s:Skin>