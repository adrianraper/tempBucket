<?xml version="1.0" encoding="utf-8"?>
<bento:BentoApplication xmlns:fx="http://ns.adobe.com/mxml/2009" 
						xmlns:s="library://ns.adobe.com/flex/spark" 
						xmlns:mx="library://ns.adobe.com/flex/mx"
						xmlns:bento="com.clarityenglish.bento.*"
						xmlns:components="com.clarityenglish.bento.view.xhtmlexercise.components.*"
						xmlns:login="com.clarityenglish.ielts.view.login.*"
						xmlns:menu="com.clarityenglish.ielts.view.title.*"
						xmlns:credits="com.clarityenglish.ielts.view.credits.*"
						xmlns:title="com.clarityenglish.ielts.view.title.*"
						creationComplete="creationComplete(event)"
						implements="com.clarityenglish.bento.view.interfaces.IBentoApplication"
						currentState="loading"
						addedToStage="onAddedToStage(event)">
	
	<bento:states>
		<s:State name="loading" />
		<s:State name="login" />
		<s:State name="title" />
		<s:State name="credits" />
	</bento:states>
	
	<fx:Script>
		<![CDATA[
			import caurina.transitions.Tweener;
			import caurina.transitions.properties.DisplayShortcuts;
			
			import com.clarityenglish.bento.BBNotifications;
			import com.clarityenglish.bento.BentoFacade;
			import com.clarityenglish.common.vo.config.BentoError;
			import com.clarityenglish.ielts.view.progress.ui.ProgressCourseBarComponent;
			
			import mx.controls.Alert;
			import mx.core.FlexGlobals;
			import mx.events.CloseEvent;
			import mx.events.FlexEvent;
			import mx.managers.BrowserManager;
			import mx.managers.IBrowserManager;
			
			public var browserManager:IBrowserManager;
			
			public static const FULL_VERSION:String = "R2IFV";
			public static const LAST_MINUTE:String = "R2ILM";
			public static const TEST_DRIVE:String = "R2ITD";
			public static const HOME_USER:String = "R2IHU";
			public static const DEMO:String = "R2ID";
			
			public static const ACADEMIC_MODULE:uint = 52;
			public static const GENERAL_TRAINING_MODULE:uint = 53;
			
			// How did this variable get generated?
			//private var com_clarityenglish_ielts_view_progress_ui_ProgressCourseBarComponent_obj:com.clarityenglish.ielts.view.progress.ui.ProgressCourseBarComponent;
			
			override protected function get facade():BentoFacade {
				return IELTSApplicationFacade.getInstance();
			}
			
			protected function creationComplete(event:FlexEvent):void {
				DisplayShortcuts.init();
				
				// Allows BandScoreCalculator-200.swf to load (in the browser)
				//Security.allowDomain("*");
				
				// Initialise the browser manager to help with capturing events that might take us away from the application
				// and also let us parse the URL
				browserManager = BrowserManager.getInstance(); 
				//browserManager.addEventListener(BrowserChangeEvent.BROWSER_URL_CHANGE, parseURL); 
				browserManager.init("", "Road to IELTS V2");
				//var url:String = browserManager.url;
				//var fragment:String = browserManager.fragment;
				
				// Hardcode/override some parameters that you expect to come from flashvars
				//FlexGlobals.topLevelApplication.parameters.rootID=163;
				//FlexGlobals.topLevelApplication.parameters.prefix = "BCHK";
				
				// Kick off the PureMVC framework with a STARTUP notification
				facade.sendNotification(BBNotifications.STARTUP, this);
			}
			
			protected function onAddedToStage(event:Event):void {
				stage.quality = StageQuality.BEST;
			}
			
			public function showErrorMessage(error:BentoError):void {
				// This is no longer used and is taken care of using notifications and commands instead
			}
			
		]]>
	</fx:Script>
	
	<!-- Gradient -->
	<s:Rect left="0" right="0" top="0" bottom="0">
		<s:fill>
			<s:LinearGradient rotation="90">
				<s:entries>
					<mx:GradientEntry color="0x000000" ratio="0.70" alpha="0.0" />
					<mx:GradientEntry color="0x000000" ratio="0.99" alpha="0.4" />
				</s:entries>
			</s:LinearGradient>
		</s:fill>
	</s:Rect>
	
	<!-- Body -->
	<s:Group left="20" right="20" top="10" bottom="{titleView.skin.currentState != 'exercise' ? 35 : 0}">
		<s:Group includeIn="loading" horizontalCenter="0" verticalCenter="60">
			<s:SWFLoader source="@Embed(source='skins/ielts/assets/loading.swf')" includeIn="loading" horizontalAlign="center"/>
		</s:Group> 
		
		<login:LoginView id="loginView" width="100%" height="100%" includeIn="login" />
		<title:TitleView id="titleView" width="100%" height="100%" includeIn="title" />
		<credits:CreditsView id="creditsView" width="100%" height="100%" includeIn="credits" />
	</s:Group>
	
	<!-- Footer -->
	<s:Group left="0" right="0" height="48" bottom="0" visible="{titleView.skin.currentState != 'exercise'}">
		<s:Rect left="0" right="0" top="0" bottom="0">
			<s:fill>
				<s:SolidColor color="#767676" />
			</s:fill>
		</s:Rect>
		<s:SWFLoader source="@Embed(source='skins/ielts/assets/assets.swf', symbol='FooterGraphic')" left="370" top="9"/>
		<s:SWFLoader source="@Embed(source='skins/ielts/assets/assets.swf', symbol='BritishCouncilIcon')" left="19" top="12" />
		<s:SWFLoader source="@Embed(source='skins/ielts/assets/assets.swf', symbol='ClarityIcon')" left="124" top="13" />
		<s:Label text="Data, Video © The British Council 2006-2012. Software, Design, Navigation © Clarity Language Consultants Ltd, 2012. All rights reserved." color="#FFFFFF" paddingTop="26" right="20" fontSize="12" />
		<s:Label text="V2.0.0.925" color="#FFFFFF" paddingTop="10" right="23" fontSize="12" />
	</s:Group>
	
	<s:TextArea id="logTextArea" visible="false" width="100%" height="100%" color="red" mouseChildren="false" mouseEnabled="false" contentBackgroundAlpha="0" />
	
</bento:BentoApplication>