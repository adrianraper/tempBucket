<?xml version="1.0" encoding="utf-8"?>
<bento:BentoApplication xmlns:fx="http://ns.adobe.com/mxml/2009" 
			   			xmlns:s="library://ns.adobe.com/flex/spark" 
			   			xmlns:mx="library://ns.adobe.com/flex/mx"
			  			xmlns:bento="com.clarityenglish.bento.*"
						xmlns:tester="com.clarityenglish.ieltstester.view.tester.*"
						implements="com.clarityenglish.bento.view.interfaces.IBentoApplication"
						creationComplete="creationComplete(event)"
						addedToStage="addedToStage(event)"
						width="100%" height="100%">
	
	<fx:Metadata>
		[SWF(width=900, height=600)]
	</fx:Metadata>
	
	<fx:Style source="ieltstester.css" />
	
	<fx:Script>
		<![CDATA[
			import com.clarityenglish.bento.BBNotifications;
			import com.clarityenglish.bento.BentoFacade;
			import com.clarityenglish.bento.vo.Href;
			import com.clarityenglish.common.vo.config.BentoError;
			
			import mx.core.FlexGlobals;
			import mx.events.FlexEvent;
			
			import spark.events.IndexChangeEvent;

			[Bindable]
			private var serverName:String;
			
			override protected function get facade():BentoFacade {
				return IELTSTesterApplicationFacade.getInstance();
			}
			
			protected function creationComplete(event:FlexEvent):void {
				// What domain are you running in?
				// Running as a debug from Flex actually uses 'URL'
				// file:///D:/ProjectBench/Software/BentoTitles/IELTSTester/bin-debug/IELTSTesterApplication.html
				// so you have to just look for part of that. Should work for DK too I think.
				if (FlexGlobals.topLevelApplication.url.toLowerCase().indexOf('claritydevelop')>=0) {
					serverName = "claritydevelop";
				} else {
					serverName = "dock.projectbench";
				}
				
				// Kick off the PureMVC framework with a STARTUP notification
				facade.sendNotification(BBNotifications.STARTUP, this);
			}
			
			protected function addedToStage(event:Event):void {
				// Select the first entry by default
				buttonBar.selectedIndex = 0;
				buttonBar.dispatchEvent(new IndexChangeEvent(IndexChangeEvent.CHANGE));
			}
			
			protected function onButtonBarChange(event:IndexChangeEvent):void {
				var href:Href = new Href(Href.XHTML, buttonBar.selectedItem.filename, buttonBar.selectedItem.currentDir);
				testerView.href = href;
			}
			
			protected function onShowAnswersClick(event:Event):void {
				facade.sendNotification(BBNotifications.SHOW_ANSWERS);
			}
			
			protected function onMarkingClick(event:MouseEvent):void {
				facade.sendNotification(BBNotifications.SHOW_MARKING);
			}
			
			public function showErrorMessage(error:BentoError):void {
				log.error("Received error {0}", error);
			}
			
		]]>
	</fx:Script>
	
	<bento:layout>
		<s:VerticalLayout gap="1" />
	</bento:layout>
	
	<s:HGroup width="100%">
		<s:ButtonBar id="buttonBar" requireSelection="true" change="onButtonBarChange(event)">
			<s:dataProvider>
				<s:ArrayCollection>
					<fx:Object label="Test cases" filename="menu.xml" currentDir="http://{serverName}/Content/IELTSTester-Dave" />
					<fx:Object label="Leisure (old)" filename="menu.xml" currentDir="http://{serverName}/Content/RoadToIELTS2-Academic" />
					<fx:Object label="Last minute" filename="menu-LastMinute.xml" currentDir="http://{serverName}/Content/IELTS-Joe" />
				</s:ArrayCollection>
			</s:dataProvider>
		</s:ButtonBar>
		
		<s:Spacer width="100%" />
		
		<s:Button label="Marking" click="onMarkingClick(event)"/>
		<s:Button label="Show correct answers" click="onShowAnswersClick(event)"/>
	</s:HGroup>
	
	<tester:TesterView id="testerView" width="100%" height="100%" />
	
</bento:BentoApplication>